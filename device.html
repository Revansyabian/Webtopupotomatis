<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUSSID & TRUKSID Money Top Up</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#001f3f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="BUSSID Top Up">
    
    <!-- Import Font untuk cetakan -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Font Awesome untuk emoji -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background-color: #001f3f;
            color: #ffffff;
            line-height: 1.5;
            padding: 10px;
            background: linear-gradient(135deg, #001f3f, #003366);
            min-height: 100vh;
        }
        
        .container {
            max-width: 450px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(0, 191, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            animation: containerSlide 0.8s ease-out;
        }
        
        @keyframes containerSlide {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .header {
            background: linear-gradient(135deg, #0074D9, #00BFFF);
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .header h1 {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.95;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }
        
        /* ============ GAME SELECTION POPUP ============ */
        .game-selection-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10002;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease-out;
        }
        
        .game-selection-content {
            background: linear-gradient(135deg, #001f3f, #003366);
            border-radius: 20px;
            padding: 40px 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 3px solid rgba(255, 255, 255, 0.3);
            animation: popupScale 0.6s ease-out;
            box-shadow: 0 20px 50px rgba(0, 191, 255, 0.4);
        }
        
        @keyframes popupScale {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .game-selection-icon {
            font-size: 70px;
            margin-bottom: 20px;
            color: #00BFFF;
            text-shadow: 0 0 30px rgba(0, 191, 255, 0.8);
            animation: bounce 2s infinite;
        }
        
        .game-selection-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 15px;
            color: white;
        }
        
        .game-selection-message {
            font-size: 16px;
            margin-bottom: 25px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.4;
        }
        
        .game-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .game-option {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .game-option:hover {
            background: rgba(0, 191, 255, 0.3);
            transform: translateY(-5px);
            border-color: #00BFFF;
        }
        
        .game-option.bussid {
            background: linear-gradient(135deg, #0074D9, #00BFFF);
            border-color: #00BFFF;
        }
        
        .game-option.truksid {
            background: linear-gradient(135deg, #FF6B6B, #FFA500);
            border-color: #FFA500;
        }
        
        .game-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .game-name {
            font-size: 18px;
            font-weight: bold;
        }
        
        /* ============ LOGIN SUCCESS POPUP ============ */
        .login-success-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10002;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease-out;
        }
        
        .login-success-content {
            background: linear-gradient(135deg, #00A86B, #00CC88);
            border-radius: 20px;
            padding: 40px 30px;
            max-width: 350px;
            width: 90%;
            text-align: center;
            border: 3px solid rgba(255, 255, 255, 0.3);
            animation: popupScale 0.6s ease-out;
            box-shadow: 0 20px 50px rgba(0, 168, 107, 0.4);
        }
        
        .login-success-icon {
            font-size: 70px;
            margin-bottom: 20px;
            color: white;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
            animation: bounce 2s infinite;
        }
        
        .login-success-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 15px;
            color: white;
        }
        
        .login-success-message {
            font-size: 16px;
            margin-bottom: 25px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.4;
        }
        
        .login-success-button {
            background: white;
            color: #00A86B;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            margin-top: 10px;
            width: 100%;
        }
        
        .login-success-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(255, 255, 255, 0.6);
        }
        
        /* ============ DEVICE ID INFO POPUP ============ */
        .device-info-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10002;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease-out;
        }
        
        .device-info-content {
            background: linear-gradient(135deg, #0074D9, #00BFFF);
            border-radius: 20px;
            padding: 40px 30px;
            max-width: 350px;
            width: 90%;
            text-align: center;
            border: 3px solid rgba(255, 255, 255, 0.3);
            animation: popupScale 0.6s ease-out;
            box-shadow: 0 20px 50px rgba(0, 116, 217, 0.4);
        }
        
        .device-info-icon {
            font-size: 70px;
            margin-bottom: 20px;
            color: white;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
        }
        
        .device-info-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 15px;
            color: white;
        }
        
        .device-info-message {
            font-size: 16px;
            margin-bottom: 25px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.4;
        }
        
        .device-info-button {
            background: white;
            color: #0074D9;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            margin-top: 10px;
            width: 100%;
        }
        
        .device-info-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(255, 255, 255, 0.6);
        }
        
        /* ============ ERROR POPUP ============ */
        .error-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10002;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease-out;
        }
        
        .error-content {
            background: linear-gradient(135deg, #FF4444, #FF6B6B);
            border-radius: 20px;
            padding: 40px 30px;
            max-width: 350px;
            width: 90%;
            text-align: center;
            border: 3px solid rgba(255, 255, 255, 0.3);
            animation: popupScale 0.6s ease-out;
            box-shadow: 0 20px 50px rgba(255, 68, 68, 0.4);
        }
        
        .error-icon {
            font-size: 70px;
            margin-bottom: 20px;
            color: white;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
        }
        
        .error-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 15px;
            color: white;
        }
        
        .error-message {
            font-size: 16px;
            margin-bottom: 25px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.4;
        }
        
        .error-button {
            background: white;
            color: #FF4444;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            margin-top: 10px;
            width: 100%;
        }
        
        .error-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(255, 255, 255, 0.6);
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* ============ SIMPLE MUSIC PLAYER ============ */
        .music-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9998;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(0, 191, 255, 0.5);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .music-toggle:hover {
            transform: scale(1.1);
            background: rgba(0, 191, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 191, 255, 0.5);
        }
        
        .music-icon {
            font-size: 24px;
            color: #00BFFF;
            transition: all 0.3s ease;
        }
        
        .music-toggle.muted .music-icon {
            color: #FF4444;
        }
        
        /* ============ LICENSE INFO ============ */
        .license-info {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }
        
        .license-status {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .license-valid {
            color: #00FF88;
        }
        
        .license-expired {
            color: #FF4444;
        }
        
        .license-days {
            font-size: 14px;
            color: #CCCCCC;
        }
        
        .renewal-section {
            text-align: center;
            padding: 25px;
            background: rgba(255, 0, 0, 0.1);
            border-radius: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255, 0, 0, 0.3);
            animation: fadeIn 0.6s ease-out;
        }
        
        .renewal-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #FF4444;
        }
        
        .renewal-message {
            color: #CCCCCC;
            margin-bottom: 20px;
            font-size: 15px;
            line-height: 1.5;
        }
        
        .access-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .access-btn {
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #FFFFFF;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }
        
        .access-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .access-btn:hover::before {
            left: 100%;
        }
        
        .access-btn:hover {
            background: rgba(0, 191, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .access-btn.week {
            background: linear-gradient(135deg, #FF6B6B, #FFA500);
            border-color: #FFA500;
        }
        
        .access-btn.month {
            background: linear-gradient(135deg, #00A86B, #00CC88);
            border-color: #00CC88;
        }
        
        .access-btn.permanent {
            background: linear-gradient(135deg, #0074D9, #00BFFF);
            border-color: #00BFFF;
        }
        
        .access-btn.double-month {
            background: linear-gradient(135deg, #9C27B0, #E91E63);
            border-color: #E91E63;
        }
        
        .access-btn.triple-month {
            background: linear-gradient(135deg, #FF5722, #FF9800);
            border-color: #FF9800;
        }
        
        .access-denied {
            text-align: center;
            padding: 40px 20px;
            color: #FF4444;
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .access-denied h3 {
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .access-denied p {
            color: #CCCCCC;
            margin-bottom: 20px;
        }
        
        .auto-wa-notice {
            background: rgba(255, 193, 7, 0.15);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            color: #FFC107;
        }
        
        /* ============ SISA CSS YANG SUDAH ADA ============ */
        .section {
            padding: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .section-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #00BFFF;
            display: flex;
            align-items: center;
            gap: 12px;
            text-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
        }
        
        .section-title::before {
            content: '‚ñ∂';
            font-size: 14px;
            color: #00BFFF;
        }
        
        .info-box {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: fadeIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .info-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .info-label {
            color: #CCCCCC;
            font-size: 15px;
            font-weight: 500;
        }
        
        .info-value {
            color: #FFFFFF;
            font-weight: bold;
            font-size: 15px;
            text-shadow: 0 0 10px rgba(0, 191, 255, 0.7);
        }
        
        .login-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 20px;
        }
        
        .login-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .login-tab.active {
            background: linear-gradient(135deg, #0074D9, #00BFFF);
            box-shadow: 0 2px 10px rgba(0, 191, 255, 0.3);
        }
        
        .login-form {
            display: none;
        }
        
        .login-form.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 10px;
            color: #CCCCCC;
            font-size: 15px;
            font-weight: 500;
        }
        
        .input-field {
            width: 100%;
            padding: 18px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            color: #FFFFFF;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .input-field::placeholder {
            color: #999999;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #00BFFF;
            box-shadow: 0 0 20px rgba(0, 191, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .amount-controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .amount-btn {
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #FFFFFF;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }
        
        .amount-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .amount-btn:hover::before {
            left: 100%;
        }
        
        .amount-btn:hover {
            background: rgba(0, 191, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .amount-btn.active {
            background: linear-gradient(135deg, #0074D9, #00BFFF);
            border-color: #00BFFF;
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.5);
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .button {
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .button:hover::before {
            left: 100%;
        }
        
        .button-primary {
            background: linear-gradient(135deg, #0074D9, #00BFFF);
            color: white;
            box-shadow: 0 4px 20px rgba(0, 191, 255, 0.4);
        }
        
        .button-secondary {
            background: linear-gradient(135deg, #0056b3, #0074D9);
            color: white;
            box-shadow: 0 4px 20px rgba(0, 116, 217, 0.4);
        }
        
        .button-success {
            background: linear-gradient(135deg, #00A86B, #00CC88);
            color: white;
            box-shadow: 0 4px 20px rgba(0, 204, 136, 0.4);
        }
        
        .button-danger {
            background: linear-gradient(135deg, #DC3545, #FF6B6B);
            color: white;
            box-shadow: 0 4px 20px rgba(220, 53, 69, 0.4);
        }
        
        .button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0, 191, 255, 0.6);
        }
        
        .button:active:not(:disabled) {
            transform: translateY(-1px);
        }
        
        .amount-display {
            text-align: center;
            font-size: 26px;
            font-weight: bold;
            color: #00BFFF;
            margin: 15px 0;
            text-shadow: 0 0 20px rgba(0, 191, 255, 0.8);
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: glow 2s infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 20px rgba(0, 191, 255, 0.8); }
            to { text-shadow: 0 0 30px rgba(0, 191, 255, 1); }
        }
        
        .max-info {
            text-align: center;
            color: #CCCCCC;
            font-size: 13px;
            margin-top: 8px;
        }
        
        .status-message {
            padding: 18px;
            border-radius: 12px;
            margin-top: 20px;
            text-align: center;
            display: none;
            font-weight: 500;
            border: 1px solid;
            font-size: 15px;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .success {
            background: rgba(0, 255, 0, 0.15);
            color: #00FF88;
            border-color: #00FF88;
        }
        
        .error {
            background: rgba(255, 0, 0, 0.15);
            color: #FF4444;
            border-color: #FF4444;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #00BFFF;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .login-section {
            background: rgba(255, 255, 255, 0.15);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #CCCCCC;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .transaction-details {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .transaction-title {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #00BFFF;
        }
        
        .transaction-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .transaction-label {
            color: #CCCCCC;
            font-size: 14px;
        }
        
        .transaction-value {
            color: #FFFFFF;
            font-weight: bold;
            font-size: 14px;
        }
        
        .transaction-success {
            color: #00FF88;
        }
        
        .transaction-info {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 191, 255, 0.1);
            border-radius: 10px;
            border-left: 4px solid #00BFFF;
        }
        
        .transaction-message {
            color: #CCCCCC;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            background: rgba(0, 191, 255, 0.3);
            border-radius: 50%;
            animation: float 6s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .feature-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #FF6B6B, #FFE66D);
            color: #000;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: bold;
            animation: bounce 2s infinite;
        }
        
        .remember-device {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        
        .remember-device input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .remember-device label {
            color: #CCCCCC;
            font-size: 14px;
            cursor: pointer;
        }
        
        .send-buyer-btn {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .send-buyer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4);
        }
        
        .buyer-modal {
            background: white;
            color: black;
            border-radius: 12px;
            padding: 20px;
            max-width: 350px;
            width: 90%;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        }
        
        .buyer-header {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            padding: 15px;
            border-radius: 8px 8px 0 0;
            margin: -20px -20px 15px -20px;
        }
        
        .buyer-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .buyer-subtitle {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .buyer-content {
            text-align: left;
            margin: 15px 0;
        }
        
        .buyer-input-group {
            margin-bottom: 15px;
        }
        
        .buyer-input-label {
            display: block;
            margin-bottom: 6px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }
        
        .buyer-input-field {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .buyer-input-field:focus {
            outline: none;
            border-color: #25D366;
            box-shadow: 0 0 0 2px rgba(37, 211, 102, 0.1);
        }
        
        .buyer-message-box {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin: 12px 0;
            border-left: 3px solid #25D366;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .buyer-message-preview {
            font-family: 'Roboto', sans-serif;
            white-space: pre-wrap;
            font-size: 12px;
            line-height: 1.4;
            color: #333;
        }
        
        .buyer-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .buyer-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .buyer-btn.primary {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
        }
        
        .buyer-btn.secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .buyer-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
        }
        
        .print-transaction-btn {
            background: linear-gradient(135deg, #FF6B6B, #FFA500);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .print-transaction-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        
        #transaction-photo-canvas {
            display: none;
        }
        
        .offline-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #FF4444;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 10001;
            display: none;
            align-items: center;
            gap: 8px;
            font-weight: bold;
        }
        
        .online-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #00A86B;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 10001;
            display: none;
            align-items: center;
            gap: 8px;
            font-weight: bold;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: modalPop 0.4s ease-out;
        }
        
        @keyframes modalPop {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .modal h3 {
            color: #FF4444;
            margin-bottom: 15px;
            font-size: 24px;
        }
        
        .modal p {
            color: #CCCCCC;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .transaction-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .transaction-emoji {
            font-size: 20px;
            margin-right: 5px;
            vertical-align: middle;
        }
        
        .hidden-section {
            display: none;
        }
        
        /* STYLE POPUP INSTALL PWA */
        .pwa-popup {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #0074D9, #00BFFF);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10000;
            max-width: 300px;
            font-family: Arial;
            animation: slideInUp 0.5s ease-out;
            border: 2px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(10px);
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .pwa-popup-content {
            text-align: center;
        }
        
        .pwa-popup h3 {
            margin: 0 0 10px 0;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .pwa-popup p {
            margin: 0 0 15px 0;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .pwa-buttons {
            display: flex;
            gap: 10px;
        }
        
        .pwa-install-btn {
            flex: 1;
            background: white;
            color: #0074D9;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .pwa-install-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,255,255,0.3);
        }
        
        .pwa-close-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pwa-close-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .pwa-install-fixed {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #0074D9, #00BFFF);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 9999;
            cursor: pointer;
            display: none;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            animation: bounce 2s infinite;
        }
        
        .game-type-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(135deg, #FF6B6B, #FFE66D);
            color: #000;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: bold;
            animation: bounce 2s infinite;
        }
    </style>
</head>
<body>
    <!-- Game Selection Popup -->
    <div class="game-selection-popup" id="gameSelectionPopup">
        <div class="game-selection-content">
            <div class="game-selection-icon">üéÆ</div>
            <div class="game-selection-title">PILIH GAME</div>
            <div class="game-selection-message" id="gameSelectionMessage">
                Pilih game yang ingin Anda top up:
            </div>
            
            <div class="game-options">
                <div class="game-option bussid" id="bussidOption">
                    <div class="game-icon">üöå</div>
                    <div class="game-name">BUSSID</div>
                </div>
                
                <div class="game-option truksid" id="truksidOption">
                    <div class="game-icon">üöõ</div>
                    <div class="game-name">TRUKSID</div>
                </div>
            </div>
            
            <button class="login-success-button" id="closeGameSelectionBtn">BATAL</button>
        </div>
    </div>

    <!-- Login Success Popup -->
    <div class="login-success-popup" id="loginSuccessPopup">
        <div class="login-success-content">
            <div class="login-success-icon">‚úÖ</div>
            <div class="login-success-title">LOGIN BERHASIL!</div>
            <div class="login-success-message" id="loginSuccessMessage">
                Selamat datang! Anda telah berhasil login ke sistem Top Up BUSSID.
            </div>
            <button class="login-success-button" id="closeLoginSuccessBtn">LANJUTKAN</button>
        </div>
    </div>

    <!-- Device ID Info Popup -->
    <div class="device-info-popup" id="deviceInfoPopup">
        <div class="device-info-content">
            <div class="device-info-icon">‚úÖ</div>
            <div class="device-info-title">DEVICE ID DITEMUKAN</div>
            <div class="device-info-message" id="deviceInfoMessage">
                Berhasil menggunakan device id yang tersimpan!
            </div>
            <button class="device-info-button" id="closeDeviceInfoBtn">LANJUTKAN</button>
        </div>
    </div>

    <!-- Error Popup -->
    <div class="error-popup" id="errorPopup">
        <div class="error-content">
            <div class="error-icon">‚ùå</div>
            <div class="error-title">DEVICE ID TIDAK DITEMUKAN</div>
            <div class="error-message" id="errorMessage">
                Maaf device id anda tidak ditemukan silakan isi secara manual
            </div>
            <button class="error-button" id="closeErrorBtn">MENGERTI</button>
        </div>
    </div>

    <!-- Simple Music Toggle Button -->
    <div class="music-toggle" id="musicToggle">
        <div class="music-icon">
            <i class="fas fa-volume-up"></i>
        </div>
    </div>

    <div class="floating-particles" id="particles"></div>
    
    <!-- Notifikasi Status Koneksi -->
    <div class="offline-notification" id="offlineNotification">
        ‚ö†Ô∏è Anda sedang offline
    </div>
    
    <div class="online-notification" id="onlineNotification">
        ‚úÖ Koneksi pulih
    </div>
    
    <!-- POPUP INSTALL PWA -->
    <div class="pwa-popup" id="pwaPopup" style="display: none;">
        <div class="pwa-popup-content">
            <h3>üì± Install App</h3>
            <p>Install BUSSID Top Up untuk pengalaman yang lebih baik!</p>
            <div class="pwa-buttons">
                <button class="pwa-install-btn" id="pwaInstallBtn">Install</button>
                <button class="pwa-close-btn" id="pwaCloseBtn">Nanti</button>
            </div>
        </div>
    </div>
    
    <!-- FLOATING INSTALL BUTTON -->
    <div class="pwa-install-fixed" id="pwaInstallFixed">
        üì± Install App
    </div>
    
    <div class="container">
        <div class="feature-badge">PREMIUM</div>
        <div class="game-type-badge" id="gameTypeBadge" style="display: none;">BUSSID</div>
        
        <div class="header">
            <h1>WEB TOP UP BUSSID & TRUKSID</h1>
            <p>Ga bisa akses? beli akses ke admin</p>
        </div>
        
        <!-- Bagian ini akan disembunyikan saat akses ditolak -->
        <div id="main-content">
            <div class="section">
                <div class="license-info" id="license-info">
                    <div class="license-status" id="license-status">Checking License...</div>
                    <div class="license-days" id="license-days"></div>
                </div>
                
                <!-- Menu Perpanjangan Akses (akan muncul saat license expired) -->
                <div class="renewal-section" id="renewal-section" style="display: none;">
                    <div class="renewal-title">‚è∞ ùóîùóûùó¶ùóòùó¶ ùóßùóòùóüùóîùóõ ùóõùóîùóïùóúùó¶</div>
                    <div class="renewal-message" id="renewal-message">
                        Akses Anda telah berakhir. Silakan perpanjang akses untuk melanjutkan menggunakan layanan top up.
                    </div>
                    
                    <div class="auto-wa-notice">
                        <h3>ùó£ùóúùóüùóúùóõ ùó£ùóîùóûùóòùóß ùó£ùóòùó•ùó£ùóîùó°ùóùùóîùó°ùóöùóîùó° ùóîùóûùó¶ùóòùó¶</h3>
                        <br>Pilih paket perpanjangan akses di bawah:
                    </div>
                    
                    <div class="access-options">
                        <button class="access-btn week" data-price="20" data-duration="1 Minggu">
                            <strong>1 MINGGU</strong><br>Rp 20.000
                        </button>
                        <button class="access-btn month" data-price="35" data-duration="2 Minggu">
                            <strong>2 MINGGU</strong><br>Rp 35.000
                        </button>
                        <button class="access-btn double-month" data-price="45" data-duration="1 Bulan">
                            <strong>1 BULAN</strong><br>Rp 45.000
                        </button>
                        <button class="access-btn triple-month" data-price="50" data-duration="2 Bulan">
                            <strong>2 BULAN</strong><br>Rp 50.000
                        </button>
                        <button class="access-btn permanent" data-price="65" data-duration="3 Bulan">
                            <strong>3 BULAN</strong><br>Rp 65.000
                        </button>
                        <button class="access-btn permanent" data-price="85" data-duration="Permanent">
                            <strong>PERMANENT</strong><br>Rp 85.000
                        </button>
                    </div>
                    
                    <p style="margin-top: 20px; color: #CCCCCC; font-size: 14px;">
                        Pencet tombol perpanjangan akses yang diinginkan:
                    </p>
                </div>
                
                <!-- Login Section (akan disembunyikan saat license expired) -->
                <div id="login-content">
                    <div class="login-section" id="login-section">
                        <div class="login-tabs">
                            <div class="login-tab active" data-tab="device">ùóóùó≤ùòÉùó∂ùó∞ùó≤ ùóúùó± ùóüùóºùó¥ùó∂ùóª</div>
                            <div class="login-tab" data-tab="xauth">X-Auth Login</div>
                        </div>
                        
                        <!-- Device ID Login Form - MANUAL INPUT -->
                        <div class="login-form active" id="device-login-form">
                            <div class="input-group">
                                <div class="input-label">ùóóùó≤ùòÉùó∂ùó∞ùó≤ ùóúùó± ùóßùóºùóΩ ùòÇùóΩ</div>
                                <input type="text" class="input-field" id="device-id-input" placeholder="ùó†ùóÆùòÄùòÇùó∏ùóÆùóª ùóóùó≤ùòÉùó∂ùó∞ùó≤ ùóúùó±">
                            </div>
                            
                            <!-- Checkbox Ingat Device ID -->
                            <div class="remember-device">
                                <input type="checkbox" id="remember-device-id">
                                <label for="remember-device-id">Ingat Device ID saya</label>
                            </div>
                            
                            <button class="button button-primary" id="device-login-btn" style="width: 100%;">
                                ùóüùó¢ùóöùóúùó° ùóüùóòùó™ùóîùóß ùóóùóòùó©ùóúùóñùóò ùóúùóó
                            </button>
                        </div>
                        
                        <!-- X-Auth Login Form -->
                        <div class="login-form" id="xauth-login-form">
                            <div class="input-group">
                                <div class="input-label">ùóßùó¢ùóûùóòùó°</div>
                                <input type="text" class="input-field" id="xauth-input" placeholder="ùó†ùóÆùòÄùòÇùó∏ùóÆùóª ùóßùóºùó∏ùó≤ùóª">
                            </div>
                            <button class="button button-success" id="xauth-login-btn" style="width: 100%;">
                                ùóüùó¢ùóöùóúùó° ùóüùóòùó™ùóîùóß ùóßùó¢ùóûùóòùó°
                            </button>
                        </div>
                    </div>
                    
                    <!-- INFORMASI AKUN - AKAN DISEMBUNYIKAN SAAT BELUM LOGIN -->
                    <div class="section-title hidden-section" id="account-info-title">ùóúùó°ùóôùó¢ùó•ùó†ùóîùó¶ùóú ùóîùóûùó®ùó°</div>
                    
                    <div class="info-box hidden-section" id="account-info">
                        <div class="info-row">
                            <div class="info-label">ùóùùó®ùó†ùóüùóîùóõ ùó®ùóîùó°ùóö</div>
                            <div class="info-value" id="cash-amount"> 0</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">ùó°ùóîùó†ùóî ùóîùóûùó®ùó°</div>
                            <div class="info-value" id="account-name">-</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">ùó°ùóîùó†ùóî</div>
                            <div class="info-value" id="license-name">-</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">ùó†ùóòùóßùó¢ùóóùóò ùóüùó¢ùóöùóúùó°</div>
                            <div class="info-value" id="login-method">-</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">ùóöùóîùó†ùóò</div>
                            <div class="info-value" id="game-type">-</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="topup-section" style="display: none;">
                <div class="section-title" id="game-section-title">ùóßùó¢ùó£ ùó®ùó£ ùó¶ùóòùó•ùó©ùóúùóñùóò</div>
                
                <div class="input-group">
                    <div class="input-label">ùó†ùóîùó¶ùó®ùóûùóîùó° ùóùùó®ùó†ùóüùóîùóõ (1 - 2,147,483,647)</div>
                    <input type="number" class="input-field" id="amount-input" placeholder="Masukkan jumlah" min="1" max="2147483647">
                    <div class="max-info">ùó†ùóîùó´ùóúùó†ùóîùóü ùó®ùóï: 2.147.483.647</div>
                </div>
                
                <div class="amount-controls">
                    <button class="amount-btn" data-amount="50000000">50 JT</button>
                    <button class="amount-btn" data-amount="100000000">100 JT</button>
                    <button class="amount-btn" data-amount="200000000">200 JT</button>
                    <button class="amount-btn" data-amount="250000000">250 JT</button>
                    <button class="amount-btn" data-amount="300000000">300 JT</button>
                    <button class="amount-btn" data-amount="350000000">350 JT</button>
                    <button class="amount-btn" data-amount="400000000">400 JT</button>
                    <button class="amount-btn" data-amount="450000000">450 JT</button>
                    <button class="amount-btn" data-amount="500000000">500 JT</button>
                    <button class="amount-btn" data-amount="550000000">550 JT</button>
                    <button class="amount-btn" data-amount="600000000">600 JT</button>
                    <button class="amount-btn" data-amount="650000000">650 JT</button>
                    <button class="amount-btn" data-amount="700000000">700 JT</button>
                    <button class="amount-btn" data-amount="750000000">750 JT</button>
                    <button class="amount-btn" data-amount="1000000000">1 M</button>   
                    <button class="amount-btn" data-amount="2147483647">2 M</button>
                </div>
                <div class="amount-display" id="selected-amount">Selected Amount: 0</div>
                
                <div class="button-group">
                    <button class="button button-primary" id="add-cash-btn">ùóßùóîùó†ùóïùóîùóõ ùó®ùóîùó°ùóö</button>
                    <button class="button button-secondary" id="reduce-cash-btn">ùóûùó®ùó•ùóîùó¶ ùó®ùóîùó°ùóö</button>
                </div>

                <div class="button-group">
                    <button class="button button-success" id="refresh-btn" style="grid-column: 1 / -1;">
                        üîÑ ùó•ùóòùóôùó•ùóòùó¶ùóõ
                    </button>
                </div>

                <button class="button button-danger" id="logout-btn" style="width: 100%; margin-top: 10px;">
                     ùóüùó¢ùóöùó¢ùó®ùóß
                </button>
                
                <div class="status-message" id="status-message"></div>
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <div>ùó£ùóøùóºùòÄùó≤ùòÄ ùòÅùóºùóΩ ùòÇùóΩ...</div>
                </div>
                
                <div class="transaction-details" id="transaction-details">
                    <div class="transaction-title">ùóóùóòùóßùóîùóúùóü ùóßùó•ùóîùó°ùó¶ùóîùóûùó¶ùóú</div>
                    <div class="transaction-row">
                        <div class="transaction-label">
                            <span class="transaction-emoji">üë§</span> Nama Akun:
                        </div>
                        <div class="transaction-value" id="trans-account">-</div>
                    </div>
                    <div class="transaction-row">
                        <div class="transaction-label">
                            <span class="transaction-emoji">üéÆ</span> Game:
                        </div>
                        <div class="transaction-value" id="trans-game">-</div>
                    </div>
                    <div class="transaction-row">
                        <div class="transaction-label">
                            <span class="transaction-emoji">üìù</span> Jenis Transaksi:
                        </div>
                        <div class="transaction-value" id="trans-type">-</div>
                    </div>
                    <div class="transaction-row">
                        <div class="transaction-label">
                            <span class="transaction-emoji">üí∞</span> Jumlah:
                        </div>
                        <div class="transaction-value" id="trans-amount">-</div>
                    </div>
                    <div class="transaction-row">
                        <div class="transaction-label">
                            <span class="transaction-emoji">üìä</span> Saldo Sebelum:
                        </div>
                        <div class="transaction-value" id="trans-before">-</div>
                    </div>
                    <div class="transaction-row">
                        <div class="transaction-label">
                            <span class="transaction-emoji">‚úÖ</span> Saldo Sesudah:
                        </div>
                        <div class="transaction-value transaction-success" id="trans-after">-</div>
                    </div>
                    <div class="transaction-row">
                        <div class="transaction-label">
                            <span class="transaction-emoji">üîÑ</span> Status:
                        </div>
                        <div class="transaction-value transaction-success" id="trans-status">-</div>
                    </div>
                    <div class="transaction-info">
                        <div class="transaction-message">
                            ‚úÖ <strong>ùóßùóºùóΩ ùòÇùóΩ ùóïùó≤ùóøùóµùóÆùòÄùó∂ùóπ!</strong><br>
                            ùóïùó≤ùóøùóµùóÆùòÄùó∂ùóπ ùóßùóºùóΩ ùó®ùóΩ ùó¶ùó∂ùóπùóÆùó∏ùóÆùóª ùóñùó≤ùó∏ ùóîùó∏ùòÇùóª ùóÆùóªùó±ùóÆ.
                        </div>
                    </div>
                    
                    <!-- Button Group untuk Transaksi -->
                    <div class="transaction-buttons">
                        <button class="print-transaction-btn" id="print-transaction-btn">
                            üñºÔ∏è FOTO TRANSAKSI HD
                        </button>
                        
                        <!-- TOMBOL BARU: KIRIM KE BUYER -->
                        <button class="send-buyer-btn" id="send-buyer-btn">
                            üì≤ KIRIM KE BUYER
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bagian ini akan ditampilkan saat akses ditolak -->
        <div class="access-denied" id="access-denied" style="display: none;">
            <h3>‚ö†Ô∏è ACCESS DENIED</h3>
            <p>ùóúùóó ùóîùóûùó¶ùóòùó¶ ùóßùóúùóóùóîùóû ùóßùóòùó•ùóóùóîùóôùóßùóîùó• ùó£ùóîùóóùóî ùóóùóîùóßùóîùóïùóîùó¶ùóò/!.</p>
            <div class="auto-wa-notice">
                <h3>ùóüùóúùó¶ùóß ùóõùóîùó•ùóöùóî ùó¶ùóòùó™ùóî ùó™ùóòùóï ùóßùó¢ùó£ ùó®ùó£ ùóïùó®ùó¶ùó¶ùóúùóó</h3>
                <br>ùó£ùó∂ùóπùó∂ùóµ ùóΩùóÆùó∏ùó≤ùòÅ ùóÆùó∏ùòÄùó≤ùòÄ ùó±ùó∂ ùóØùóÆùòÑùóÆùóµ:
            </div>
            
            <div class="access-options">
                <button class="access-btn week" data-price="20" data-duration="1 Minggu">
                    <strong>1 MINGGU</strong><br>Rp 20.000
                </button>
                <button class="access-btn month" data-price="35" data-duration="2 Minggu">
                    <strong>2 MINGGU</strong><br>Rp 35.000
                </button>
                <button class="access-btn double-month" data-price="45" data-duration="1 Bulan">
                    <strong>1 BULAN</strong><br>Rp 45.000
                </button>
                <button class="access-btn triple-month" data-price="50" data-duration="2 Bulan">
                    <strong>2 BULAN</strong><br>Rp 50.000
                </button>
                <button class="access-btn permanent" data-price="65" data-duration="3 Bulan">
                    <strong>3 BULAN</strong><br>Rp 65.000
                </button>
                <button class="access-btn permanent" data-price="85" data-duration="Permanent">
                    <strong>PERMANENT</strong><br>Rp 85.000
                </button>
            </div>
            
            <p style="margin-top: 20px;">ùó£ùó≤ùóªùó∞ùó≤ùòÅ ùòÅùóºùó∫ùóØùóºùóπ ùóÆùó∏ùòÄùó≤ùòÄ ùòÜùóÆùóªùó¥ ùó±ùó∂ùó∂ùóªùó¥ùó∂ùóªùó∏ùóÆùóª:</p>
        </div>
        
        <div class="footer">
            <p>web by revan store</p>
            <p>beli akses chat admin</p>
        </div>
    </div>

    <!-- Modal untuk Kirim ke Buyer -->
    <div class="modal-overlay" id="buyer-modal-overlay">
        <div class="buyer-modal" id="buyer-modal">
            <div class="buyer-header">
                <div class="buyer-title">KIRIM KE BUYER</div>
                <div class="buyer-subtitle">Kirim detail transaksi via WhatsApp</div>
            </div>
            
            <div class="buyer-content">
                <div class="buyer-input-group">
                    <label class="buyer-input-label">Nomor WhatsApp:</label>
                    <input type="text" class="buyer-input-field" id="whatsapp-number-input" 
                           placeholder="Contoh: 6281234567890">
                </div>
                
                <div class="buyer-input-group">
                    <label class="buyer-input-label">Pesan Tambahan:</label>
                    <textarea class="buyer-input-field" id="additional-message" rows="2" 
                              placeholder="Tambahkan pesan untuk buyer..."></textarea>
                </div>
                
                <div class="buyer-message-box">
                    <div class="buyer-input-label">Preview Pesan:</div>
                    <div class="buyer-message-preview" id="message-preview">
                        <!-- Preview akan diisi oleh JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="buyer-actions">
                <button class="buyer-btn secondary" id="close-buyer-modal">Batal</button>
                <button class="buyer-btn primary" id="send-whatsapp-btn">üì≤ Kirim WhatsApp</button>
            </div>
        </div>
    </div>

    <!-- Canvas untuk gambar transaksi HD -->
    <canvas id="transaction-photo-canvas"></canvas>

    <!-- Canvas untuk konversi ke gambar (tersembunyi) -->
    <canvas id="screenshot-canvas" style="display: none;"></canvas>

    <script>
        // ==================== KONFIGURASI ====================
        const PLAYFAB_TITLE_ID_BUSSID = "4AE9";
        const PLAYFAB_TITLE_ID_TRUKSID = "89A0B";
        const PLAYFAB_API_URL_BUSSID = "https://4AE9.playfabapi.com";
        const PLAYFAB_API_URL_TRUKSID = "https://89A0B.playfabapi.com";
        const LICENSE_BASE_URL = "https://api.github.com/repos/Revansyabian/Webtopupotomatis/contents/lisensi";
        const ADMIN_PHONE = '6289520418604';
        
        // ==================== SIMPLE MUSIC CONFIGURATION ====================
        const BACKGROUND_MUSIC_URL = "https://on.soundcloud.com/1BeiT4dNuEZRlnyEUH";
        
        // ==================== VARIABEL GLOBAL ====================
        let authToken = "";
        let cashAmount = 0;
        let accountName = "";
        let selectedAmount = 0;
        let previousBalance = 0;
        let currentLoginMethod = "";
        let lastTransactionData = null;
        let licenseData = null;
        let deviceId = "";
        let backgroundMusic = null;
        let isMusicMuted = false;
        let currentGame = ""; // "bussid" atau "truksid"
        let currentGameApiUrl = "";
        let currentGameTitleId = "";
        
        // ==================== ELEMEN DOM ====================
        function getElement(id) {
            const element = document.getElementById(id);
            if (!element) console.warn(`Element '${id}' not found`);
            return element;
        }
        
        // Popup elements
        const gameSelectionPopup = getElement('gameSelectionPopup');
        const gameSelectionMessage = getElement('gameSelectionMessage');
        const bussidOption = getElement('bussidOption');
        const truksidOption = getElement('truksidOption');
        const closeGameSelectionBtn = getElement('closeGameSelectionBtn');
        
        const loginSuccessPopup = getElement('loginSuccessPopup');
        const loginSuccessMessage = getElement('loginSuccessMessage');
        const closeLoginSuccessBtn = getElement('closeLoginSuccessBtn');
        
        const deviceInfoPopup = getElement('deviceInfoPopup');
        const deviceInfoMessage = getElement('deviceInfoMessage');
        const closeDeviceInfoBtn = getElement('closeDeviceInfoBtn');
        
        const errorPopup = getElement('errorPopup');
        const errorMessage = getElement('errorMessage');
        const closeErrorBtn = getElement('closeErrorBtn');
        
        // Music elements
        const musicToggle = getElement('musicToggle');
        
        // License elements
        const licenseStatus = getElement('license-status');
        const licenseDays = getElement('license-days');
        const licenseInfo = getElement('license-info');
        const renewalSection = getElement('renewal-section');
        const renewalMessage = getElement('renewal-message');
        const loginContent = getElement('login-content');
        const licenseNameElement = getElement('license-name');
        
        // Main content elements
        const mainContent = getElement('main-content');
        const accessDenied = getElement('access-denied');
        const deviceIdInput = getElement('device-id-input');
        const xauthInput = getElement('xauth-input');
        const deviceLoginBtn = getElement('device-login-btn');
        const xauthLoginBtn = getElement('xauth-login-btn');
        const loginTabs = document.querySelectorAll('.login-tab');
        const loginForms = document.querySelectorAll('.login-form');
        const cashAmountElement = getElement('cash-amount');
        const accountNameElement = getElement('account-name');
        const loginMethodElement = getElement('login-method');
        const gameTypeElement = getElement('game-type');
        const gameTypeBadge = getElement('gameTypeBadge');
        const gameSectionTitle = getElement('game-section-title');
        const amountInput = getElement('amount-input');
        const addCashBtn = getElement('add-cash-btn');
        const reduceCashBtn = getElement('reduce-cash-btn');
        const refreshBtn = getElement('refresh-btn');
        const logoutBtn = getElement('logout-btn');
        const selectedAmountElement = getElement('selected-amount');
        const statusMessage = getElement('status-message');
        const loadingElement = getElement('loading');
        const amountButtons = document.querySelectorAll('.amount-btn');
        const transactionDetails = getElement('transaction-details');
        const topupSection = getElement('topup-section');
        const loginSection = getElement('login-section');
        const accountInfo = getElement('account-info');
        const accountInfoTitle = getElement('account-info-title');
        const rememberDeviceIdCheckbox = getElement('remember-device-id');
        const printTransactionBtn = getElement('print-transaction-btn');
        const transactionPhotoCanvas = getElement('transaction-photo-canvas');
        const transGameElement = getElement('trans-game');
        
        // Access option buttons
        const accessOptionButtons = document.querySelectorAll('.access-options .access-btn, .renewal-section .access-btn');
        
        // ==================== SIMPLE MUSIC PLAYER ====================
        
        function initBackgroundMusic() {
            backgroundMusic = new Audio();
            backgroundMusic.src = BACKGROUND_MUSIC_URL;
            backgroundMusic.volume = 0.3;
            backgroundMusic.loop = true;
            
            document.addEventListener('click', function startMusic() {
                if (backgroundMusic && !isMusicMuted) {
                    backgroundMusic.play().catch(e => {
                        console.log('Autoplay prevented:', e);
                    });
                }
                document.removeEventListener('click', startMusic);
            });
            
            backgroundMusic.addEventListener('error', (e) => {
                console.log('Error loading music:', e);
            });
        }
        
        function toggleMusic() {
            if (!backgroundMusic) return;
            
            if (isMusicMuted) {
                backgroundMusic.volume = 0.3;
                backgroundMusic.play().catch(e => {
                    console.log('Play failed:', e);
                });
                musicToggle.classList.remove('muted');
                musicToggle.querySelector('.music-icon').innerHTML = '<i class="fas fa-volume-up"></i>';
            } else {
                backgroundMusic.volume = 0;
                musicToggle.classList.add('muted');
                musicToggle.querySelector('.music-icon').innerHTML = '<i class="fas fa-volume-mute"></i>';
            }
            
            isMusicMuted = !isMusicMuted;
        }
        
        // ==================== FUNGSI POPUP ====================
        
        function showGameSelectionPopup() {
            gameSelectionMessage.textContent = `Halo ${licenseData.name}! Pilih game yang ingin Anda top up:`;
            gameSelectionPopup.style.display = 'flex';
        }
        
        function showLoginSuccessPopup(loginMethod, accountName) {
            loginSuccessMessage.textContent = `Login dengan ${loginMethod} berhasil!\nSelamat datang ${accountName}!`;
            loginSuccessPopup.style.display = 'flex';
            
            setTimeout(() => {
                loginSuccessPopup.style.display = 'none';
            }, 3000);
        }
        
        function showDeviceInfoPopup(message = "Berhasil menggunakan device id yang tersimpan!") {
            deviceInfoMessage.textContent = message;
            deviceInfoPopup.style.display = 'flex';
            
            setTimeout(() => {
                deviceInfoPopup.style.display = 'none';
            }, 3000);
        }
        
        function showErrorPopup(message = "Maaf device id anda tidak ditemukan silakan isi secara manual") {
            errorMessage.textContent = message;
            errorPopup.style.display = 'flex';
        }
        
        // ==================== FUNGSI INGAT DEVICE ID ====================
        
        function saveDeviceId(deviceId, gameType = "") {
            if (rememberDeviceIdCheckbox && rememberDeviceIdCheckbox.checked) {
                localStorage.setItem(`bussid_remembered_device_id_${gameType}`, deviceId);
                localStorage.setItem(`bussid_remembered_game`, gameType);
                console.log(`Device ID ${gameType} disimpan:`, deviceId);
            }
        }
        
        function loadRememberedDeviceId(gameType = "") {
            // Coba load berdasarkan game type
            let savedDeviceId = localStorage.getItem(`bussid_remembered_device_id_${gameType}`);
            let savedGame = localStorage.getItem(`bussid_remembered_game`);
            
            // Jika ada device ID untuk game ini
            if (savedDeviceId && savedGame === gameType) {
                if (deviceIdInput) {
                    deviceIdInput.value = savedDeviceId;
                    // Centang checkbox
                    if (rememberDeviceIdCheckbox) {
                        rememberDeviceIdCheckbox.checked = true;
                    }
                    console.log(`Device ID ${gameType} dimuat:`, savedDeviceId);
                    return true;
                }
            }
            
            // Jika tidak ada untuk game ini, coba load yang umum
            savedDeviceId = localStorage.getItem('bussid_remembered_device_id');
            if (savedDeviceId && deviceIdInput) {
                deviceIdInput.value = savedDeviceId;
                if (rememberDeviceIdCheckbox) {
                    rememberDeviceIdCheckbox.checked = true;
                }
                console.log('Device ID umum dimuat:', savedDeviceId);
                return true;
            }
            
            return false;
        }
        
        function clearRememberedDeviceId() {
            // Hapus semua device ID yang disimpan
            localStorage.removeItem('bussid_remembered_device_id');
            localStorage.removeItem('bussid_remembered_device_id_bussid');
            localStorage.removeItem('bussid_remembered_device_id_truksid');
            localStorage.removeItem('bussid_remembered_game');
            
            if (deviceIdInput) deviceIdInput.value = '';
            if (rememberDeviceIdCheckbox) rememberDeviceIdCheckbox.checked = false;
            console.log('Semua Device ID dihapus');
        }
        
        // ==================== LICENSE SYSTEM ====================
        
        function generatePermanentLicenseDeviceId() {
            let deviceId = localStorage.getItem('bussid_license_device_id');
            
            if (!deviceId) {
                const components = [
                    'LIC_',
                    navigator.userAgent,
                    navigator.platform,
                    screen.width + 'x' + screen.height,
                    new Date().getTimezoneOffset(),
                    navigator.language,
                    navigator.hardwareConcurrency || 'unknown'
                ].join('|');
                
                let hash = 0;
                for (let i = 0; i < components.length; i++) {
                    const char = components.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                
                deviceId = 'LIC_' + Math.abs(hash).toString(24).substring(0, 12).toUpperCase();
                localStorage.setItem('bussid_license_device_id', deviceId);
                console.log('Generated PERMANENT License Device ID:', deviceId);
            } else {
                console.log('Using existing PERMANENT License Device ID:', deviceId);
            }
            
            return deviceId;
        }
        
        async function checkLicense(deviceId) {
            setLoading(true);
            try {
                const response = await fetch(`${LICENSE_BASE_URL}/${deviceId}.json`);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error('LICENSE_NOT_FOUND');
                    }
                    throw new Error('Gagal mengambil data license');
                }
                
                const data = await response.json();
                
                if (data.content) {
                    const decodedContent = atob(data.content.replace(/\n/g, ''));
                    licenseData = JSON.parse(decodedContent);
                } else {
                    licenseData = data;
                }
                
                return licenseData;
            } catch (error) {
                if (error.message === 'LICENSE_NOT_FOUND') {
                    return null;
                }
                throw error;
            } finally {
                setLoading(false);
            }
        }
        
        function calculateDaysLeft(expiryDate) {
            try {
                const [day, month, year] = expiryDate.split('-').map(Number);
                const expiry = new Date(year, month - 1, day);
                const today = new Date();
                const diff = expiry - today;
                const daysLeft = Math.ceil(diff / (1000 * 60 * 60 * 24));
                return daysLeft;
            } catch (error) {
                console.error('Error calculating days left:', error);
                return -1;
            }
        }
        
        function calculateDaysExpired(expiryDate) {
            try {
                const [day, month, year] = expiryDate.split('-').map(Number);
                const expiry = new Date(year, month - 1, day);
                const today = new Date();
                const diff = today - expiry;
                const daysExpired = Math.floor(diff / (1000 * 60 * 60 * 24));
                return daysExpired;
            } catch (error) {
                console.error('Error calculating days expired:', error);
                return -1;
            }
        }
        
        function updateLicenseDisplay(license) {
            if (!licenseStatus || !licenseDays) return false;
            
            if (!license) {
                licenseStatus.textContent = "‚ùå ùóúùóó ùóîùóûùó¶ùóòùó¶ ùóßùóúùóóùóîùóû ùó©ùóîùóüùóúùóó";
                licenseStatus.className = "license-status license-expired";
                licenseDays.textContent = "ID tidak terdaftar pada database";
                return false;
            }
            
            const daysLeft = calculateDaysLeft(license.expiry_date);
            
            if (daysLeft > 0 || license.expiry_date === "1-09-9999") {
                licenseStatus.textContent = "‚úÖ ùóúùóó ùóîùóûùó¶ùóòùó¶ ùó©ùóîùóüùóúùóó";
                licenseStatus.className = "license-status license-valid";
                if (license.expiry_date === "1-09-9999") {
                    licenseDays.textContent = "Masa aktif: PERMANEN";
                } else {
                    licenseDays.textContent = `Masa aktif: ${daysLeft} hari tersisa`;
                }
                
                if (licenseNameElement) licenseNameElement.textContent = license.name;
                if (renewalSection) renewalSection.style.display = 'none';
                if (loginContent) loginContent.style.display = 'block';
                
                return true;
            } else {
                licenseStatus.textContent = "‚ùå ùóîùóûùó¶ùóòùó¶ ùóßùóòùóüùóîùóõ ùóïùóòùó•ùóîùóûùóõùóúùó•";
                licenseStatus.className = "license-status license-expired";
                const daysExpired = calculateDaysExpired(license.expiry_date);
                licenseDays.textContent = `Masa aktif telah habis ${daysExpired} hari yang lalu`;
                
                if (licenseNameElement) licenseNameElement.textContent = license.name;
                
                if (renewalSection && renewalMessage) {
                    renewalSection.style.display = 'block';
                    renewalMessage.innerHTML = `Akses Anda telah berakhir <strong>${daysExpired} hari</strong> yang lalu.<br>
                                                Silakan perpanjang akses untuk melanjutkan menggunakan layanan top up.`;
                }
                if (loginContent) loginContent.style.display = 'none';
                
                return false;
            }
        }
        
        function setupGameBasedOnLicense() {
            if (!licenseData) return;
            
            console.log("License data:", licenseData);
            
            const bussidEnabled = licenseData.bussid === "yes";
            const truksidEnabled = licenseData.truksid === "yes";
            
            if (bussidEnabled && truksidEnabled) {
                // Kedua game enabled, tampilkan popup pilihan
                showGameSelectionPopup();
            } else if (bussidEnabled) {
                // Hanya BUSSID enabled
                setupForGame("bussid");
                autoFillDeviceIdIfAvailable();
            } else if (truksidEnabled) {
                // Hanya TRUKSID enabled
                setupForGame("truksid");
                autoFillDeviceIdIfAvailable();
            } else {
                // Tidak ada game enabled
                showErrorPopup("Maaf, tidak ada game yang diaktifkan untuk license Anda");
            }
        }
        
        function setupForGame(gameType) {
            currentGame = gameType;
            
            if (gameType === "bussid") {
                currentGameApiUrl = PLAYFAB_API_URL_BUSSID;
                currentGameTitleId = PLAYFAB_TITLE_ID_BUSSID;
                gameTypeBadge.textContent = "BUSSID";
                gameSectionTitle.textContent = "ùóßùó¢ùó£ ùó®ùó£ ùóïùó®ùó¶ùó¶ùóúùóó";
                gameTypeBadge.style.display = "block";
                gameTypeBadge.style.background = "linear-gradient(135deg, #0074D9, #00BFFF)";
            } else if (gameType === "truksid") {
                currentGameApiUrl = PLAYFAB_API_URL_TRUKSID;
                currentGameTitleId = PLAYFAB_TITLE_ID_TRUKSID;
                gameTypeBadge.textContent = "TRUKSID";
                gameSectionTitle.textContent = "ùóßùó¢ùó£ ùó®ùó£ ùóßùó•ùó®ùóûùó¶ùóúùóó";
                gameTypeBadge.style.display = "block";
                gameTypeBadge.style.background = "linear-gradient(135deg, #FF6B6B, #FFA500)";
            }
            
            // Update UI untuk game yang dipilih
            if (gameTypeElement) gameTypeElement.textContent = gameType.toUpperCase();
        }
        
        function autoFillDeviceIdIfAvailable() {
            if (!licenseData) return;
            
            let deviceIdToFill = "";
            
            if (currentGame === "bussid" && licenseData.deviceid_bussid) {
                deviceIdToFill = licenseData.deviceid_bussid;
            } else if (currentGame === "truksid" && licenseData.deviceid_truksid) {
                deviceIdToFill = licenseData.deviceid_truksid;
            }
            
            if (deviceIdToFill && deviceIdInput) {
                deviceIdInput.value = deviceIdToFill;
                showDeviceInfoPopup(`Berhasil menggunakan device id ${currentGame.toUpperCase()} yang tersimpan!`);
                console.log(`Auto-filled ${currentGame} device ID:`, deviceIdToFill);
            } else {
                showErrorPopup(`Device ID ${currentGame.toUpperCase()} tidak ditemukan dalam license, silakan isi manual`);
            }
        }
        
        function openWhatsAppForLicense(deviceId, price, duration, isRenewal = false) {
            let message = '';
            
            if (isRenewal) {
                message = `Assalamu'alaikum, saya mau perpanjang akses Web Top Up Bussid ${duration} seharga Rp ${price}.000.\n\nAkses ID: ${deviceId}\nTanggal: ${new Date().toLocaleDateString('id-ID')}`;
            } else {
                message = `Assalamu'alaikum, saya mau beli akses Web Top Up Bussid ${duration} seharga Rp ${price}.000.\n\nAkses ID: ${deviceId}\nTanggal: ${new Date().toLocaleDateString('id-ID')}`;
            }
            
            const whatsappUrl = `https://wa.me/${ADMIN_PHONE}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }
        
        // ==================== TRANSACTION PHOTO ====================
        
        function generateTransactionPhoto() {
            if (!lastTransactionData) {
                showStatus('Tidak ada data transaksi untuk dibuat foto', false);
                return;
            }
            
            const canvas = transactionPhotoCanvas;
            const ctx = canvas.getContext('2d');
            
            canvas.width = 1920;
            canvas.height = 1080;
            
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#001f3f');
            gradient.addColorStop(1, '#003366');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const headerGradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
            headerGradient.addColorStop(0, '#0074D9');
            headerGradient.addColorStop(1, '#00BFFF');
            ctx.fillStyle = headerGradient;
            ctx.fillRect(0, 0, canvas.width, 200);
            
            ctx.fillStyle = '#FFFFFF';
            ctx.font = 'bold 80px "Montserrat", sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('üéÆ BUKTI TRANSAKSI BUSSID üéÆ', canvas.width / 2, 100);
            
            ctx.font = '35px "Roboto", sans-serif';
            ctx.fillText('üí∞ Top Up Money Berhasil üí∞', canvas.width / 2, 150);
            
            const contentX = 150;
            const contentY = 300;
            const contentWidth = canvas.width - 300;
            const contentHeight = 600;
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.15)';
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.roundRect(contentX, contentY, contentWidth, contentHeight, 40);
            ctx.fill();
            ctx.stroke();
            
            const emojiData = [
                { emoji: 'üë§', label: 'Nama Akun', value: lastTransactionData.account },
                { emoji: 'üéÆ', label: 'Game', value: lastTransactionData.game },
                { emoji: 'üìù', label: 'Jenis Transaksi', value: lastTransactionData.type },
                { emoji: 'üí∞', label: 'Jumlah UB', value: lastTransactionData.amount.toLocaleString() + ' UB' },
                { emoji: 'üìä', label: 'Saldo Sebelum', value: lastTransactionData.before.toLocaleString() + ' UB' },
                { emoji: '‚úÖ', label: 'Saldo Sesudah', value: lastTransactionData.after.toLocaleString() + ' UB' },
                { emoji: 'üîÑ', label: 'Status', value: lastTransactionData.status },
                { emoji: 'üìÖ', label: 'Tanggal & Waktu', value: lastTransactionData.date },
                { emoji: 'üéØ', label: 'ID Transaksi', value: 'BUSSID-' + Date.now().toString().slice(-8) }
            ];
            
            let yPos = contentY + 100;
            const lineHeight = 70;
            
            emojiData.forEach(item => {
                ctx.font = '45px Arial';
                ctx.fillText(item.emoji, contentX + 50, yPos);
                
                ctx.font = 'bold 34px "Roboto", sans-serif';
                ctx.fillStyle = '#00BFFF';
                ctx.fillText(item.label + ':', contentX + 120, yPos);
                
                ctx.font = 'bold 38px "Roboto", sans-serif';
                if (item.label.includes('Sesudah') || item.label.includes('Status')) {
                    ctx.fillStyle = '#00FF88';
                } else if (item.label.includes('UB')) {
                    ctx.fillStyle = '#FFD700';
                } else {
                    ctx.fillStyle = '#FFFFFF';
                }
                
                ctx.textAlign = 'right';
                ctx.fillText(item.value, contentX + contentWidth - 50, yPos);
                ctx.textAlign = 'left';
                
                if (yPos < contentY + contentHeight - 100) {
                    ctx.strokeStyle = 'rgba(0, 191, 255, 0.3)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(contentX + 50, yPos + 35);
                    ctx.lineTo(contentX + contentWidth - 50, yPos + 35);
                    ctx.stroke();
                }
                
                yPos += lineHeight;
            });
            
            ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
            ctx.fillRect(0, canvas.height - 150, canvas.width, 150);
            
            ctx.strokeStyle = 'rgba(0, 191, 255, 0.5)';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(0, canvas.height - 150);
            ctx.lineTo(canvas.width, canvas.height - 150);
            ctx.stroke();
            
            ctx.fillStyle = '#CCCCCC';
            ctx.font = '28px "Roboto", sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('üéÆ ¬© BUSSID Money Top Up üéÆ', canvas.width / 2, canvas.height - 90);
            ctx.fillText('üì± web by revan store üì±', canvas.width / 2, canvas.height - 50);
            
            const qrSize = 100;
            const qrX = canvas.width - qrSize - 50;
            const qrY = canvas.height - qrSize - 40;
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.strokeStyle = '#00BFFF';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.roundRect(qrX, qrY, qrSize, qrSize, 10);
            ctx.fill();
            ctx.stroke();
            
            ctx.fillStyle = '#FFFFFF';
            ctx.font = 'bold 20px "Roboto", sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('üîí', qrX + qrSize/2, qrY + qrSize/2);
            ctx.font = '12px "Roboto", sans-serif';
            ctx.fillText('SECURE', qrX + qrSize/2, qrY + qrSize/2 + 20);
            
            const imageData = canvas.toDataURL('image/jpeg', 0.95);
            
            const downloadLink = document.createElement('a');
            downloadLink.href = imageData;
            downloadLink.download = `bukti-transaksi-${currentGame}-${Date.now()}.jpg`;
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            showStatus('‚úÖ Foto transaksi HD berhasil dibuat dan diunduh!', true);
        }
        
        // ==================== FUNGSI BANTUAN ====================
        
        function showStatus(message, isSuccess) {
            if (!statusMessage) return;
            
            statusMessage.textContent = message;
            statusMessage.className = 'status-message ' + (isSuccess ? 'success' : 'error');
            statusMessage.style.display = 'block';
            
            setTimeout(() => {
                if (statusMessage) statusMessage.style.display = 'none';
            }, 5000);
        }
        
        function setLoading(isLoading) {
            if (!loadingElement) return;
            loadingElement.style.display = isLoading ? 'block' : 'none';
        }
        
        function updateSelectedAmountDisplay() {
            if (!selectedAmountElement) return;
            selectedAmountElement.textContent = `Selected Amount: ${selectedAmount.toLocaleString()}`;
        }
        
        function showTransactionDetails(account, game, type, amount, before, after, status) {
            const transAccount = getElement('trans-account');
            const transGame = getElement('trans-game');
            const transType = getElement('trans-type');
            const transAmount = getElement('trans-amount');
            const transBefore = getElement('trans-before');
            const transAfter = getElement('trans-after');
            const transStatus = getElement('trans-status');
            
            if (transAccount) transAccount.textContent = account;
            if (transGame) transGame.textContent = game;
            if (transType) transType.textContent = type;
            if (transAmount) transAmount.textContent = amount.toLocaleString();
            if (transBefore) transBefore.textContent = before.toLocaleString();
            if (transAfter) transAfter.textContent = after.toLocaleString();
            if (transStatus) transStatus.textContent = status;
            
            lastTransactionData = {
                account: account,
                game: game,
                type: type,
                amount: amount,
                before: before,
                after: after,
                status: status,
                date: new Date().toLocaleString('id-ID')
            };
            
            if (transactionDetails) {
                transactionDetails.style.display = 'block';
                transactionDetails.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        function showAccountInfo() {
            if (accountInfoTitle && accountInfo) {
                accountInfoTitle.classList.remove('hidden-section');
                accountInfo.classList.remove('hidden-section');
            }
        }
        
        function hideAccountInfo() {
            if (accountInfoTitle && accountInfo) {
                accountInfoTitle.classList.add('hidden-section');
                accountInfo.classList.add('hidden-section');
            }
        }
        
        // ==================== FUNGSI LOGIN & TOPUP ====================
        
        async function loginWithDeviceId(deviceId) {
            if (!deviceId) {
                showStatus('Masukkan Device ID untuk Top Up UB!', false);
                return false;
            }
            
            if (!currentGame) {
                showStatus('Pilih game terlebih dahulu!', false);
                return false;
            }
            
            setLoading(true);
            
            try {
                const loginData = {
                    AndroidDeviceId: deviceId,
                    TitleId: currentGameTitleId,
                    CreateAccount: true,
                    InfoRequestParameters: {
                        GetUserAccountInfo: true,
                        GetUserVirtualCurrency: true
                    }
                };
                
                console.log(`Login data untuk ${currentGame}:`, loginData);
                
                const response = await fetch(`${currentGameApiUrl}/Client/LoginWithAndroidDeviceID`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(loginData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: Login dengan Device ID gagal`);
                }
                
                const data = await response.json();
                
                if (data.data && data.data.SessionTicket) {
                    authToken = data.data.SessionTicket;
                    currentLoginMethod = "Device ID";
                    
                    if (data.data.InfoResultPayload) {
                        const info = data.data.InfoResultPayload;
                        cashAmount = info.UserVirtualCurrency?.RP || 0;
                        accountName = info.AccountInfo?.TitleInfo?.DisplayName || 'Unknown';
                        
                        if (cashAmountElement) cashAmountElement.textContent = cashAmount.toLocaleString();
                        if (accountNameElement) accountNameElement.textContent = accountName;
                        if (loginMethodElement) loginMethodElement.textContent = currentLoginMethod;
                        if (gameTypeElement) gameTypeElement.textContent = currentGame.toUpperCase();
                    }
                    
                    saveDeviceId(deviceId, currentGame);
                    
                    showLoginSuccessPopup(currentLoginMethod, accountName);
                    
                    showAccountInfo();
                    return true;
                } else {
                    throw new Error('Token session tidak diterima dari PlayFab');
                }
            } catch (error) {
                console.error('Login error:', error);
                showStatus('Login gagal: ' + error.message, false);
                return false;
            } finally {
                setLoading(false);
            }
        }
        
        async function loginWithXAuth(xAuthToken) {
            setLoading(true);
            
            try {
                authToken = xAuthToken;
                currentLoginMethod = "X-Authorization";
                const userInfo = await getUserInfo();
                
                if (userInfo) {
                    showLoginSuccessPopup(currentLoginMethod, userInfo.name);
                    
                    showAccountInfo();
                    return true;
                } else {
                    throw new Error('token tidak valid');
                }
            } catch (error) {
                showStatus('Login gagal: ' + error.message, false);
                return false;
            } finally {
                setLoading(false);
            }
        }
        
        async function getUserInfo() {
            if (!authToken) return null;
            
            try {
                const data = {
                    InfoRequestParameters: {
                        GetUserAccountInfo: true,
                        GetUserVirtualCurrency: true
                    }
                };
                
                const response = await fetch(`${currentGameApiUrl}/Client/GetPlayerCombinedInfo`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Authorization': authToken
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) throw new Error('Gagal mengambil informasi akun');
                
                const result = await response.json();
                
                if (result.code === 200) {
                    const info = result.data.InfoResultPayload;
                    cashAmount = info.UserVirtualCurrency?.RP || 0;
                    accountName = info.AccountInfo?.TitleInfo?.DisplayName || 'Unknown';
                    
                    if (cashAmountElement) cashAmountElement.textContent = cashAmount.toLocaleString();
                    if (accountNameElement) accountNameElement.textContent = accountName;
                    if (loginMethodElement) loginMethodElement.textContent = currentLoginMethod;
                    
                    return { name: accountName, balance: cashAmount };
                } else {
                    throw new Error(result.errorMessage || 'Error mengambil data');
                }
            } catch (error) {
                showStatus('Gagal mengambil info: ' + error.message, false);
                return null;
            }
        }
        
        async function modifyCash(amount) {
            if (!authToken) {
                showStatus('Silakan login terlebih dahulu', false);
                return false;
            }
            
            if (amount === 0) {
                showStatus('Jumlah tidak boleh 0', false);
                return false;
            }
            
            setLoading(true);
            
            try {
                previousBalance = cashAmount;
                
                const data = {
                    FunctionName: "AddRp",
                    FunctionParameter: { addValue: amount },
                    RevisionSelection: "Live",
                    GeneratePlayStreamEvent: false
                };
                
                const response = await fetch(`${currentGameApiUrl}/Client/ExecuteCloudScript`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Authorization': authToken
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) throw new Error('HTTP Error: ' + response.status);
                
                const result = await response.json();
                
                if (result.data && result.data.FunctionName === 'AddRp') {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    await getUserInfo();
                    
                    const action = amount > 0 ? 'ditambahkan' : 'dikurangi';
                    const absAmount = Math.abs(amount);
                    
                    showTransactionDetails(
                        accountName,
                        currentGame.toUpperCase(),
                        amount > 0 ? 'TOP UP' : 'REDUCE',
                        absAmount,
                        previousBalance,
                        cashAmount,
                        'SUCCESS'
                    );
                    
                    showStatus(`Berhasil ${action} ${absAmount.toLocaleString()} cash!`, true);
                    
                    selectedAmount = 0;
                    if (amountInput) amountInput.value = '';
                    updateSelectedAmountDisplay();
                    
                    return true;
                } else {
                    const errorMsg = result.data?.Error?.Message || 'Gagal memproses';
                    throw new Error(errorMsg);
                }
            } catch (error) {
                showStatus('Gagal: ' + error.message, false);
                return false;
            } finally {
                setLoading(false);
            }
        }
        
        function logout() {
            authToken = "";
            cashAmount = 0;
            accountName = "";
            selectedAmount = 0;
            currentLoginMethod = "";
            lastTransactionData = null;
            
            if (topupSection) topupSection.style.display = 'none';
            if (loginSection) loginSection.style.display = 'block';
            if (transactionDetails) transactionDetails.style.display = 'none';
            if (cashAmountElement) cashAmountElement.textContent = '-';
            if (accountNameElement) accountNameElement.textContent = '-';
            if (loginMethodElement) loginMethodElement.textContent = '-';
            if (gameTypeElement) gameTypeElement.textContent = '-';
            if (deviceIdInput) deviceIdInput.value = '';
            if (xauthInput) xauthInput.value = '';
            
            hideAccountInfo();
            showStatus('Logout berhasil!', true);
        }
        
        // ==================== EVENT LISTENERS ====================
        
        document.addEventListener('DOMContentLoaded', async function() {
            initBackgroundMusic();
            
            if (musicToggle) {
                musicToggle.addEventListener('click', toggleMusic);
            }
            
            // Popup close buttons
            if (closeGameSelectionBtn) {
                closeGameSelectionBtn.addEventListener('click', () => {
                    gameSelectionPopup.style.display = 'none';
                });
            }
            
            if (closeLoginSuccessBtn) {
                closeLoginSuccessBtn.addEventListener('click', () => {
                    loginSuccessPopup.style.display = 'none';
                });
            }
            
            if (closeDeviceInfoBtn) {
                closeDeviceInfoBtn.addEventListener('click', () => {
                    deviceInfoPopup.style.display = 'none';
                });
            }
            
            if (closeErrorBtn) {
                closeErrorBtn.addEventListener('click', () => {
                    errorPopup.style.display = 'none';
                });
            }
            
            // Game selection options
            if (bussidOption) {
                bussidOption.addEventListener('click', () => {
                    setupForGame("bussid");
                    gameSelectionPopup.style.display = 'none';
                    autoFillDeviceIdIfAvailable();
                });
            }
            
            if (truksidOption) {
                truksidOption.addEventListener('click', () => {
                    setupForGame("truksid");
                    gameSelectionPopup.style.display = 'none';
                    autoFillDeviceIdIfAvailable();
                });
            }
            
            // Generate device ID untuk license
            deviceId = generatePermanentLicenseDeviceId();
            
            // Check license
            const license = await checkLicense(deviceId);
            
            // Update license display
            const isValid = updateLicenseDisplay(license);
            
            // Langsung tampilkan aplikasi
            if (license && isValid) {
                if (mainContent) mainContent.style.display = 'block';
                if (accessDenied) accessDenied.style.display = 'none';
                
                // Setup game berdasarkan license
                setupGameBasedOnLicense();
                
                // Load remembered device ID untuk game yang dipilih
                if (currentGame) {
                    loadRememberedDeviceId(currentGame);
                }
            } else {
                if (mainContent) mainContent.style.display = 'none';
                if (accessDenied) accessDenied.style.display = 'block';
            }
            
            // Setup access option buttons
            accessOptionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const price = this.getAttribute('data-price');
                    const duration = this.getAttribute('data-duration');
                    const isRenewal = this.closest('.renewal-section') !== null;
                    openWhatsAppForLicense(deviceId, price, duration, isRenewal);
                });
            });
            
            if (printTransactionBtn) {
                printTransactionBtn.addEventListener('click', generateTransactionPhoto);
            }
            
            // Login tab switcher
            if (loginTabs && loginTabs.length > 0) {
                loginTabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        loginTabs.forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        loginForms.forEach(form => form.classList.remove('active'));
                        document.getElementById(`${tab.dataset.tab}-login-form`).classList.add('active');
                    });
                });
            }
            
            // Device ID login
            if (deviceLoginBtn) {
                deviceLoginBtn.addEventListener('click', async () => {
                    const inputDeviceId = deviceIdInput ? deviceIdInput.value.trim() : '';
                    const loginSuccess = await loginWithDeviceId(inputDeviceId);
                    if (loginSuccess) {
                        if (topupSection) topupSection.style.display = 'block';
                        if (loginSection) loginSection.style.display = 'none';
                    }
                });
            }
            
            // X-Auth login
            if (xauthLoginBtn) {
                xauthLoginBtn.addEventListener('click', async () => {
                    const xAuthToken = xauthInput ? xauthInput.value.trim() : '';
                    if (!xAuthToken) {
                        showStatus('Masukkan X-Authorization Token!', false);
                        return;
                    }
                    
                    const loginSuccess = await loginWithXAuth(xAuthToken);
                    if (loginSuccess) {
                        if (topupSection) topupSection.style.display = 'block';
                        if (loginSection) loginSection.style.display = 'none';
                    }
                });
            }
            
            // Amount buttons
            if (amountButtons && amountButtons.length > 0) {
                amountButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        amountButtons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        
                        selectedAmount = parseInt(this.dataset.amount);
                        if (amountInput) amountInput.value = selectedAmount;
                        updateSelectedAmountDisplay();
                    });
                });
            }
            
            // Amount input change
            if (amountInput) {
                amountInput.addEventListener('input', function() {
                    let value = parseInt(this.value) || 0;
                    
                    if (value > 2147483647) {
                        value = 2147483647;
                        this.value = value;
                    }
                    
                    selectedAmount = value;
                    
                    if (amountButtons && amountButtons.length > 0) {
                        amountButtons.forEach(btn => {
                            if (parseInt(btn.dataset.amount) === value) {
                                btn.classList.add('active');
                            } else {
                                btn.classList.remove('active');
                            }
                        });
                    }
                    
                    updateSelectedAmountDisplay();
                });
            }
            
            // Add cash button
            if (addCashBtn) {
                addCashBtn.addEventListener('click', async () => {
                    if (selectedAmount <= 0) {
                        showStatus('Pilih jumlah terlebih dahulu!', false);
                        return;
                    }
                    
                    if (selectedAmount > 2147483647) {
                        showStatus('Jumlah melebihi batas maksimal!', false);
                        return;
                    }
                    
                    await modifyCash(selectedAmount);
                });
            }
            
            // Reduce cash button
            if (reduceCashBtn) {
                reduceCashBtn.addEventListener('click', async () => {
                    if (selectedAmount <= 0) {
                        showStatus('Pilih jumlah terlebih dahulu!', false);
                        return;
                    }
                    
                    if (selectedAmount > cashAmount) {
                        showStatus('Saldo tidak cukup!', false);
                        return;
                    }
                    
                    await modifyCash(-selectedAmount);
                });
            }
            
            // Refresh balance button
            if (refreshBtn) {
                refreshBtn.addEventListener('click', async () => {
                    await getUserInfo();
                    showStatus('Saldo berhasil di-refresh!', true);
                });
            }
            
            // Logout button
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    clearRememberedDeviceId();
                    logout();
                });
            }
            
            // Add roundRect if not exists
            if (!CanvasRenderingContext2D.prototype.roundRect) {
                CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
                    if (w < 2 * r) r = w / 2;
                    if (h < 2 * r) r = h / 2;
                    this.beginPath();
                    this.moveTo(x + r, y);
                    this.arcTo(x + w, y, x + w, y + h, r);
                    this.arcTo(x + w, y + h, x, y + h, r);
                    this.arcTo(x, y + h, x, y, r);
                    this.arcTo(x, y, x + w, y, r);
                    this.closePath();
                    return this;
                }
            }
        });
    </script>
</body>
</html>